<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [gecode-users] embedded gecode
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:users%40gecode.org?Subject=Re%3A%20%5Bgecode-users%5D%20embedded%20gecode&In-Reply-To=%3CB0470054-D20B-43E1-AB96-EBAE89DBE13E%40gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="003218.html">
   <LINK REL="Next"  HREF="003224.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[gecode-users] embedded gecode</H1>
    <B>Ruben Zilibowitz</B> 
    <A HREF="mailto:users%40gecode.org?Subject=Re%3A%20%5Bgecode-users%5D%20embedded%20gecode&In-Reply-To=%3CB0470054-D20B-43E1-AB96-EBAE89DBE13E%40gmail.com%3E"
       TITLE="[gecode-users] embedded gecode">ruben.zilibowitz at gmail.com
       </A><BR>
    <I>Sat Apr  9 02:56:56 CEST 2011</I>
    <P><UL>
        <LI>Previous message: <A HREF="003218.html">[gecode-users] embedded gecode
</A></li>
        <LI>Next message: <A HREF="003224.html">[gecode-users] embedded gecode
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#3219">[ date ]</a>
              <a href="thread.html#3219">[ thread ]</a>
              <a href="subject.html#3219">[ subject ]</a>
              <a href="author.html#3219">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>
On 09/04/2011, at 10:55 AM, Ruben Zilibowitz wrote:

&gt;<i> 
</I>&gt;<i> On 09/04/2011, at 7:11 AM, Guido Tack wrote:
</I>&gt;<i> 
</I>&gt;&gt;<i> Ruben Zilibowitz wrote:
</I>&gt;&gt;<i> 
</I>&gt;&gt;&gt;<i> This is a brilliant idea! Definitely helps to reduce file size.
</I>&gt;&gt;<i> 
</I>&gt;&gt;<i> What I was wondering is whether you can use our Makefiles to build Gecode for iOS, or do you have to turn the whole of Gecode into an XCode project?
</I>&gt;<i> 
</I>&gt;<i> I believe I first did:
</I>&gt;<i> ./configure --enable-static --disable-shared --disable-gist --disable-qt
</I>&gt;<i> in order to generate the config.hpp file
</I>
edit: I also ran make

&gt;<i> 
</I>&gt;<i> Then it was just a matter of adding the gecode folder with all the source code to Xcode. Then I removed some files I didn't need and were causing errors. And that was it.
</I>&gt;<i> 
</I>&gt;&gt;&gt;<i> On another matter, I don't seem to be receiving my own emails to the list. Even though Receive your own posts to the list is set to yes. Are my posts getting to the list at all?
</I>&gt;&gt;<i> 
</I>&gt;&gt;<i> They are.  You can always check the archives at
</I>&gt;&gt;<i> <A HREF="http://news.gmane.org/gmane.comp.lib.gecode.user">http://news.gmane.org/gmane.comp.lib.gecode.user</A>
</I>&gt;<i> 
</I>&gt;<i> Ok.
</I>&gt;<i> 
</I>&gt;<i> Ruben
</I>&gt;<i> 
</I>&gt;&gt;<i> Guido
</I>&gt;&gt;<i> 
</I>&gt;&gt;&gt;<i> 
</I>&gt;&gt;&gt;<i> Ruben
</I>&gt;&gt;&gt;<i> 
</I>&gt;&gt;&gt;<i> On 08/04/2011, at 9:47 PM, Christian Schulte wrote:
</I>&gt;&gt;&gt;<i> 
</I>&gt;&gt;&gt;&gt;<i> There might be an additional way to make the binaries smaller. After running configure, you can edit the file
</I>&gt;&gt;&gt;&gt;<i>                 gecode/support/config.hpp
</I>&gt;&gt;&gt;&gt;<i> and change the line
</I>&gt;&gt;&gt;&gt;<i>  
</I>&gt;&gt;&gt;&gt;<i> /* How to tell the compiler to really, really inline */
</I>&gt;&gt;&gt;&gt;<i> #define forceinline inline __attribute__ ((__always_inline__))
</I>&gt;&gt;&gt;&gt;<i>  
</I>&gt;&gt;&gt;&gt;<i> to
</I>&gt;&gt;&gt;&gt;<i>  
</I>&gt;&gt;&gt;&gt;<i> /* How to tell the compiler to really, really inline */
</I>&gt;&gt;&gt;&gt;<i> #define forceinline inline
</I>&gt;&gt;&gt;&gt;<i>  
</I>&gt;&gt;&gt;&gt;<i> This reduces the amount of inlining (hopefully). I do not know which difference it makes for gcc though. For MSVC on Windows it saves 35% for the integer module and 50% for the set module.
</I>&gt;&gt;&gt;&gt;<i>  
</I>&gt;&gt;&gt;&gt;<i> Christian
</I>&gt;&gt;&gt;&gt;<i>  
</I>&gt;&gt;&gt;&gt;<i> --
</I>&gt;&gt;&gt;&gt;<i> Christian Schulte, www.ict.kth.se/~cschulte/
</I>&gt;&gt;&gt;&gt;<i>  
</I>&gt;&gt;&gt;&gt;<i> From: <A HREF="http://www.gecode.org/cgi-bin/mailman/listinfo/users">users-bounces at gecode.org</A> [mailto:<A HREF="http://www.gecode.org/cgi-bin/mailman/listinfo/users">users-bounces at gecode.org</A>] On Behalf Of Guido Tack
</I>&gt;&gt;&gt;&gt;<i> Sent: Friday, April 08, 2011 12:45 PM
</I>&gt;&gt;&gt;&gt;<i> To: Mikael Zayenz Lagerkvist
</I>&gt;&gt;&gt;&gt;<i> Cc: <A HREF="http://www.gecode.org/cgi-bin/mailman/listinfo/users">users at gecode.org</A> list
</I>&gt;&gt;&gt;&gt;<i> Subject: Re: [gecode-users] embedded gecode
</I>&gt;&gt;&gt;&gt;<i>  
</I>&gt;&gt;&gt;&gt;<i> Mikael Zayenz Lagerkvist wrote:
</I>&gt;&gt;&gt;&gt;<i> 
</I>&gt;&gt;&gt;&gt;<i> 
</I>&gt;&gt;&gt;&gt;<i> On Fri, Apr 8, 2011 at 6:54 AM, Ruben Zilibowitz &lt;<A HREF="http://www.gecode.org/cgi-bin/mailman/listinfo/users">ruben.zilibowitz at gmail.com</A>&gt; wrote:
</I>&gt;&gt;&gt;&gt;<i> 
</I>&gt;&gt;&gt;&gt;<i> &gt;&gt; 2) My executables, even after dead code elimination and other optimisations are very large. It's around 17 Mb. I'm not sure there's an easy fix for this, but any ideas would be welcome, for how to reduce file size of the executable. It seems that there are many features I'm not going to need, so perhaps I can try to strip down the library.
</I>&gt;&gt;&gt;&gt;<i> &gt;
</I>&gt;&gt;&gt;&gt;<i> &gt; First of all, that sounds like you're linking statically, right?  It's true, the Gecode libraries are a bit on the fat side.  What you can definitely do is strip the debug symbols.  Other than that, I think the linker already only includes the symbols that it needs, so there's not much you can do in addition.
</I>&gt;&gt;&gt;&gt;<i> 
</I>&gt;&gt;&gt;&gt;<i> Yes, statically. I'm not sure there's any other way when it comes to building iPhone apps. That 17 Mb is for a &quot;fat&quot; binary that supports two architectures (armv6 and armv7). So the real figure is about half that. Still it would be nice if it was smaller.
</I>&gt;&gt;&gt;&gt;<i>  
</I>&gt;&gt;&gt;&gt;<i> Stripping debug symbols helps a lot with size. On my machine, the size of the dynamic libraries goes from 52 MiB to 7.1 MiB when stripped.
</I>&gt;&gt;&gt;&gt;<i>  
</I>&gt;&gt;&gt;&gt;<i> In addition, you can try and compile Gecode with -Os as optimization flag. It won't be as fast, but it might make the executable smaller (I haven't tried it, you'll need to experiment). Also, make sure that you are only including the parts that you need (Gist and flatzinc might not be relevant for example). 
</I>&gt;&gt;&gt;&gt;<i>  
</I>&gt;&gt;&gt;&gt;<i> Gist won't be compiled anyway (no Qt on iOS), and flatzinc is usually not linked unless you actually use it.
</I>&gt;&gt;&gt;&gt;<i>  
</I>&gt;&gt;&gt;&gt;<i> On Darwin (Mac OS, iOS), the option for minimizing size is -Oz (-Os also exists but is slightly less radical).  Here's a table of executable sizes (x86_64 on Mac OS):
</I>&gt;&gt;&gt;&gt;<i>  
</I>&gt;&gt;&gt;&gt;<i>                                                             -O3                  -O3 stripped                -Oz                  -Oz stripped    -Oz clang            -Oz clang stripped
</I>&gt;&gt;&gt;&gt;<i> examples/queens:        8,2M    4,9M                            7,6M    3,8M                7,3M                3,3M
</I>&gt;&gt;&gt;&gt;<i> tools/flatzinc/fz:                      15M     9,1M                            13M     7,1M                13M                 6,2M
</I>&gt;&gt;&gt;&gt;<i> 
</I>&gt;&gt;&gt;&gt;<i> 
</I>&gt;&gt;&gt;&gt;<i> If you really want to make the executables as small as possible, then you could start to remove parts that you are not using. You might want to investigate if there is a way to make your compilation tool-chain do automatic dead-code removal.
</I>&gt;&gt;&gt;&gt;<i>  
</I>&gt;&gt;&gt;&gt;<i> I thought the linker did that automatically, but apparently, it doesn't.  You can tell the linker explicitly to remove dead code.  On Darwin, that's done using the -dead_strip flag (and that's possibly enabled by default in XCode, I'm not sure).  
</I>&gt;&gt;&gt;&gt;<i> With -dead_strip, examples/queens goes down to 4,4M with -Oz, or 2,3M stripped.  So, comparing -O3 nonstripped to -Oz -Wl,-dead_strip stripped, we can reduce the binary by 70%.
</I>&gt;&gt;&gt;&gt;<i>  
</I>&gt;&gt;&gt;&gt;<i> Still, quite a lot of symbols end up in the executable that I can't explain, e.g. most of the set library seems to be included in the queens executable.  So indeed, if your constraint model does not use set constraints, consider compiling Gecode with --disable-set-vars.  Here are the numbers for queens without set variables:
</I>&gt;&gt;&gt;&gt;<i>                                                             -Oz                  -Oz stripped    -Oz -dead_strip           -Oz -dead_strip stripped
</I>&gt;&gt;&gt;&gt;<i> examples/queens:        6,2M    2,9M                3,2M                            1,5M
</I>&gt;&gt;&gt;&gt;<i>  
</I>&gt;&gt;&gt;&gt;<i> We could probably reduce the size even further by carefully looking at the symbols and removing unused stuff.  But anyway, this already saves 80% code size.
</I>&gt;&gt;&gt;&gt;<i>  
</I>&gt;&gt;&gt;&gt;<i> Another thing I tried (just for fun) was to compile using clang with -O4, enabling link-time optimization.  The smallest size I could get for queens (but including set variables) was 2,2M, which is not too bad either, considering that this does full optimization.
</I>&gt;&gt;&gt;&gt;<i>  
</I>&gt;&gt;&gt;&gt;<i> Cheers,
</I>&gt;&gt;&gt;&gt;<i>             Guido
</I>&gt;&gt;&gt;&gt;<i>  
</I>&gt;&gt;&gt;&gt;<i> -- 
</I>&gt;&gt;&gt;&gt;<i> Guido Tack, <A HREF="http://people.cs.kuleuven.be/~guido.tack/">http://people.cs.kuleuven.be/~guido.tack/</A>
</I>&gt;&gt;&gt;&gt;<i>  
</I>&gt;&gt;&gt;&gt;<i> _______________________________________________
</I>&gt;&gt;&gt;&gt;<i> Gecode users mailing list
</I>&gt;&gt;&gt;&gt;<i> <A HREF="http://www.gecode.org/cgi-bin/mailman/listinfo/users">users at gecode.org</A>
</I>&gt;&gt;&gt;&gt;<i> <A HREF="https://www.gecode.org/mailman/listinfo/gecode-users">https://www.gecode.org/mailman/listinfo/gecode-users</A>
</I>&gt;&gt;&gt;<i> 
</I>&gt;&gt;&gt;<i> _______________________________________________
</I>&gt;&gt;&gt;<i> Gecode users mailing list
</I>&gt;&gt;&gt;<i> <A HREF="http://www.gecode.org/cgi-bin/mailman/listinfo/users">users at gecode.org</A>
</I>&gt;&gt;&gt;<i> <A HREF="https://www.gecode.org/mailman/listinfo/gecode-users">https://www.gecode.org/mailman/listinfo/gecode-users</A>
</I>&gt;&gt;<i> 
</I>&gt;&gt;<i> -- 
</I>&gt;&gt;<i> Guido Tack, <A HREF="http://people.cs.kuleuven.be/~guido.tack/">http://people.cs.kuleuven.be/~guido.tack/</A>
</I>&gt;&gt;<i> 
</I>&gt;&gt;<i> 
</I>&gt;&gt;<i> 
</I>&gt;&gt;<i> 
</I>&gt;<i> 
</I>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;<A HREF="http://www.gecode.org/pipermail/users/attachments/20110409/3a26275e/attachment-0001.htm">http://www.gecode.org/pipermail/users/attachments/20110409/3a26275e/attachment-0001.htm</A>&gt;
</PRE>


<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="003218.html">[gecode-users] embedded gecode
</A></li>
	<LI>Next message: <A HREF="003224.html">[gecode-users] embedded gecode
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#3219">[ date ]</a>
              <a href="thread.html#3219">[ thread ]</a>
              <a href="subject.html#3219">[ subject ]</a>
              <a href="author.html#3219">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://www.gecode.org/cgi-bin/mailman/listinfo/users">More information about the users
mailing list</a><br>
</body></html>
