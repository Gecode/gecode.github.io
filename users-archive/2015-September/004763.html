<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [gecode-users] Freeze with MSVC 2015 optimized build
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:users%40gecode.org?Subject=Re%3A%20%5Bgecode-users%5D%20Freeze%20with%20MSVC%202015%20optimized%20build&In-Reply-To=%3Cmtgsg1%24uaj%241%40ger.gmane.org%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="004762.html">
   <LINK REL="Next"  HREF="004764.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[gecode-users] Freeze with MSVC 2015 optimized build</H1>
    <B>Filip Konvi&#269;ka</B> 
    <A HREF="mailto:users%40gecode.org?Subject=Re%3A%20%5Bgecode-users%5D%20Freeze%20with%20MSVC%202015%20optimized%20build&In-Reply-To=%3Cmtgsg1%24uaj%241%40ger.gmane.org%3E"
       TITLE="[gecode-users] Freeze with MSVC 2015 optimized build">filip.konvicka at logis.cz
       </A><BR>
    <I>Fri Sep 18 13:28:01 CEST 2015</I>
    <P><UL>
        <LI>Previous message: <A HREF="004762.html">[gecode-users] Freeze with MSVC 2015 optimized build
</A></li>
        <LI>Next message: <A HREF="004764.html">[gecode-users] Disjunctive Minizinc constraint
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#4763">[ date ]</a>
              <a href="thread.html#4763">[ thread ]</a>
              <a href="subject.html#4763">[ subject ]</a>
              <a href="author.html#4763">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Christian,

Thanks much for looking into this.  I would be really interested to know 
the crux of the bug.

I believe that the float variables are using Boost.Interval for the 
calculations, right? There are rounding policies that can be used with 
that library (that should guarantee specific precision and rounding 
behavior), but I'm not sure what overhead there is associated with that 
and whether/how it interferes with compiler settings.

Since it appears that in my particular case there are problems with the 
FLOAT_VAL_SPLIT_MAX branching, I wonder whether there are some 
invariants/assumptions in the branching code that the SSE2 breaks.

But you're saying that SSE2 has been the default for quite some time, so 
I wonder why this hasn't been a problem with MSVC 2013 too.

Cheers
Filip



Dne 18. 9. 2015 v 12:22 Christian Schulte napsal(a):
&gt;<i> Your environment is fine, it is really MSVC 2015. I can re-produce your
</I>&gt;<i> problems with both x86 and x64... And it appears to be really bad.
</I>&gt;<i>
</I>&gt;<i> But I think I found at least something: by default, MSVC uses SSE2
</I>&gt;<i> arithmetic (has been since quite some time, in particular for x64). If you
</I>&gt;<i> force the compiler to use x87 arithmetic instead (which is really bad as it
</I>&gt;<i> also has an impact on integer performance) by -ARCH:IA32 then at least the
</I>&gt;<i> tests seem to work (you can pass by make CXXUSR=-ARCH:IA32 when you build
</I>&gt;<i> Gecode).
</I>&gt;<i>
</I>&gt;<i> However your test still does not work (terminates immediately with bringing
</I>&gt;<i> up Gist).
</I>&gt;<i>
</I>&gt;<i> I think we will have to fix the Gecode build to use x87 for the float stuff.
</I>&gt;<i>
</I>&gt;<i> Cheers
</I>&gt;<i> Christian
</I>&gt;<i>
</I>&gt;<i> --
</I>&gt;<i> Christian Schulte, www.gecode.org/~schulte
</I>&gt;<i> Professor of Computer Science, KTH, <A HREF="http://www.gecode.org/cgi-bin/mailman/listinfo/users">cschulte at kth.se</A>
</I>&gt;<i> Expert Researcher, SICS, <A HREF="http://www.gecode.org/cgi-bin/mailman/listinfo/users">cschulte at sics.se</A>
</I>&gt;<i>
</I>&gt;<i> -----Original Message-----
</I>&gt;<i> From: <A HREF="http://www.gecode.org/cgi-bin/mailman/listinfo/users">users-bounces at gecode.org</A> [mailto:<A HREF="http://www.gecode.org/cgi-bin/mailman/listinfo/users">users-bounces at gecode.org</A>] On Behalf
</I>&gt;<i> Of Filip Konvicka
</I>&gt;<i> Sent: Thursday, September 17, 2015 05:43 PM
</I>&gt;<i> To: <A HREF="http://www.gecode.org/cgi-bin/mailman/listinfo/users">users at gecode.org</A>
</I>&gt;<i> Subject: Re: [gecode-users] Freeze with MSVC 2015 optimized build
</I>&gt;<i>
</I>&gt;<i> ...and &quot;Float::Arithmetic::Div::Sol::A&quot; seems to be failing fast with any
</I>&gt;<i> seed.
</I>&gt;<i>
</I>&gt;<i> So it might really be my build setup - although I hope it's not as it is
</I>&gt;<i> basically the same as that I've been using for years :)
</I>&gt;<i>
</I>&gt;<i> Cheers,
</I>&gt;<i> Filip
</I>&gt;<i>
</I>&gt;&gt;<i> It only happens with Gecode compiled in release mode with MSVC 2015.
</I>&gt;&gt;<i> There are no such official Gecode binaries, so I wasn't sure whether
</I>&gt;&gt;<i> my build environment was set up correctly - but it probably is.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> This is an excerpt from my original post that explains what seems to
</I>&gt;&gt;<i> be triggering the problem:
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>   &gt; In the test case source code there is a constant  &gt;
</I>&gt;&gt;<i> &quot;8686.9666660000003&quot;. Changing it to &quot;8686&quot; seems to fix the problem
</I>&gt;&gt;&gt;<i> - but even &quot;8686.9&quot; makes dfs freeze.  It also seems that it is the
</I>&gt;&gt;&gt;<i> branching strategy 'FLOAT_VAL_SPLIT_MAX' that is causing problems.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> Regarding the build environment, I tried running some tests, and it
</I>&gt;&gt;<i> seems to fail &quot;Float::Arithmetic::Div::C&quot;:
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> ...
</I>&gt;&gt;<i> Float::Arithmetic::Div::B +++++
</I>&gt;&gt;<i> Float::Arithmetic::Div::C -
</I>&gt;&gt;<i> Options: -seed 71643696 -test Float::Arithmetic::Div::C
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> I wonder whether this passes in your environment.  The &quot;Div&quot; tests
</I>&gt;&gt;<i> seem to run slow.  The same test with the seed 71643693 seems to pass.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> Cheers,
</I>&gt;&gt;<i> Filip
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> Uuups, gosh. That I did not know. Right now I cannot try MSV 2013
</I>&gt;&gt;&gt;<i> easily as I am travelling. But maybe I'll check somehow.
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> Cheers
</I>&gt;&gt;&gt;<i> Christian
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> --
</I>&gt;&gt;&gt;<i> Christian Schulte, www.gecode.org/~schulte Professor of Computer
</I>&gt;&gt;&gt;<i> Science, KTH, <A HREF="http://www.gecode.org/cgi-bin/mailman/listinfo/users">cschulte at kth.se</A> Expert Researcher, SICS,
</I>&gt;&gt;&gt;<i> <A HREF="http://www.gecode.org/cgi-bin/mailman/listinfo/users">cschulte at sics.se</A>
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> -----Original Message-----
</I>&gt;&gt;&gt;<i> From: <A HREF="http://www.gecode.org/cgi-bin/mailman/listinfo/users">users-bounces at gecode.org</A>
</I>&gt;&gt;&gt;<i> [mailto:<A HREF="http://www.gecode.org/cgi-bin/mailman/listinfo/users">users-bounces at gecode.org</A>] On Behalf Of Filip Konvicka
</I>&gt;&gt;&gt;<i> Sent: Thursday, September 17, 2015 05:02 PM
</I>&gt;&gt;&gt;<i> To: <A HREF="http://www.gecode.org/cgi-bin/mailman/listinfo/users">users at gecode.org</A>
</I>&gt;&gt;&gt;<i> Subject: Re: [gecode-users] Freeze with MSVC 2015 optimized build
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> Hi Christian,
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> Thanks!  OK - I just know that the official Gecode 4.4.0 distribution
</I>&gt;&gt;&gt;<i> (MSVC
</I>&gt;&gt;&gt;<i> 2013) works OK, and so does the debug (non-optimized) version built
</I>&gt;&gt;&gt;<i> from trunk using MSVC 2015.
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> Cheers,
</I>&gt;&gt;&gt;<i> Filip
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;&gt;<i> Hi Filip,
</I>&gt;&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;&gt;<i> This seems to be an issue with Gecode and not the compiler... Guido
</I>&gt;&gt;&gt;&gt;<i> promised me that he will look into floats. Real soon, he said ;-)
</I>&gt;&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;&gt;<i> Cheers
</I>&gt;&gt;&gt;&gt;<i> Christian
</I>&gt;&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;&gt;<i> --
</I>&gt;&gt;&gt;&gt;<i> Christian Schulte, www.gecode.org/~schulte Professor of Computer
</I>&gt;&gt;&gt;&gt;<i> Science, KTH, <A HREF="http://www.gecode.org/cgi-bin/mailman/listinfo/users">cschulte at kth.se</A> Expert Researcher, SICS,
</I>&gt;&gt;&gt;&gt;<i> <A HREF="http://www.gecode.org/cgi-bin/mailman/listinfo/users">cschulte at sics.se</A>
</I>&gt;&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;&gt;<i> -----Original Message-----
</I>&gt;&gt;&gt;&gt;<i> From: <A HREF="http://www.gecode.org/cgi-bin/mailman/listinfo/users">users-bounces at gecode.org</A>
</I>&gt;&gt;&gt;&gt;<i> [mailto:<A HREF="http://www.gecode.org/cgi-bin/mailman/listinfo/users">users-bounces at gecode.org</A>] On Behalf Of Filip Konvicka
</I>&gt;&gt;&gt;&gt;<i> Sent: Thursday, September 17, 2015 03:39 PM
</I>&gt;&gt;&gt;&gt;<i> To: <A HREF="http://www.gecode.org/cgi-bin/mailman/listinfo/users">users at gecode.org</A>
</I>&gt;&gt;&gt;&gt;<i> Subject: Re: [gecode-users] Freeze with MSVC 2015 optimized build
</I>&gt;&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;&gt;<i> Sure, it's the script from my original post.  I'm re-attaching it now.
</I>&gt;&gt;&gt;&gt;<i> I also used Gecode trunk (updated about September 1st) with Qt-5.5,
</I>&gt;&gt;&gt;&gt;<i> built in my Cygwin environment with MSVC 2015 RTM x64 compiler.
</I>&gt;&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;&gt;<i> Thanks,
</I>&gt;&gt;&gt;&gt;<i> Filip
</I>&gt;&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;&gt;&gt;<i> Hi Filip,
</I>&gt;&gt;&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;&gt;&gt;<i> If you tell me which script you tried, I can try here (even though
</I>&gt;&gt;&gt;&gt;&gt;<i> Gist works for me with MSVC 2015 and Qt-5.5.0, using the trunk).
</I>&gt;&gt;&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;&gt;&gt;<i> Cheers
</I>&gt;&gt;&gt;&gt;&gt;<i> Christian
</I>&gt;&gt;&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;&gt;&gt;<i> --
</I>&gt;&gt;&gt;&gt;&gt;<i> Christian Schulte, www.gecode.org/~schulte Professor of Computer
</I>&gt;&gt;&gt;&gt;&gt;<i> Science, KTH, <A HREF="http://www.gecode.org/cgi-bin/mailman/listinfo/users">cschulte at kth.se</A> Expert Researcher, SICS,
</I>&gt;&gt;&gt;&gt;&gt;<i> <A HREF="http://www.gecode.org/cgi-bin/mailman/listinfo/users">cschulte at sics.se</A>
</I>&gt;&gt;&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;&gt;&gt;<i> -----Original Message-----
</I>&gt;&gt;&gt;&gt;&gt;<i> From: <A HREF="http://www.gecode.org/cgi-bin/mailman/listinfo/users">users-bounces at gecode.org</A>
</I>&gt;&gt;&gt;&gt;&gt;<i> [mailto:<A HREF="http://www.gecode.org/cgi-bin/mailman/listinfo/users">users-bounces at gecode.org</A>] On Behalf Of Filip Konvicka
</I>&gt;&gt;&gt;&gt;&gt;<i> Sent: Thursday, September 17, 2015 03:24 PM
</I>&gt;&gt;&gt;&gt;&gt;<i> To: <A HREF="http://www.gecode.org/cgi-bin/mailman/listinfo/users">users at gecode.org</A>
</I>&gt;&gt;&gt;&gt;&gt;<i> Subject: Re: [gecode-users] Freeze with MSVC 2015 optimized build
</I>&gt;&gt;&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;&gt;&gt;&gt;<i> I was trying to use the Qt installer but Qt does not seem to be
</I>&gt;&gt;&gt;&gt;&gt;&gt;<i> visible in the cygwin environment.  I'll try the source package as
</I>&gt;&gt;&gt;&gt;&gt;&gt;<i> you suggest, that sounds better to me.
</I>&gt;&gt;&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;&gt;&gt;<i> So in the end I finished using the pre-built version of Qt and I'm
</I>&gt;&gt;&gt;&gt;&gt;<i> now able to run the script in Gist (Gist::dfs). The issue is still
</I>&gt;&gt;&gt;&gt;&gt;<i> there.
</I>&gt;&gt;&gt;&gt;&gt;<i> I ran 'Next Solution' - this apparently runs the search in a
</I>&gt;&gt;&gt;&gt;&gt;<i> separate thread but never finishes (and 'Stop' does not stop the
</I>&gt;&gt;&gt;&gt;&gt;<i> search, you have to kill the program). Inspecting the nodes one by
</I>&gt;&gt;&gt;&gt;&gt;<i> one freezes the program during the 3rd expansion, and in this case
</I>&gt;&gt;&gt;&gt;&gt;<i> the program stops
</I>&gt;&gt;&gt;&gt;<i> responding altogether.
</I>&gt;&gt;&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;&gt;&gt;<i> So my guess is this is really some tight loop somewhere in Gecode
</I>&gt;&gt;&gt;&gt;&gt;<i> (maybe caused by a new optimization or bug in the new compiler?)
</I>&gt;&gt;&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;&gt;&gt;<i> Cheers,
</I>&gt;&gt;&gt;&gt;&gt;<i> Filip
</I>&gt;&gt;&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;&gt;&gt;<i> _______________________________________________
</I>&gt;&gt;&gt;&gt;&gt;<i> Gecode users mailing list
</I>&gt;&gt;&gt;&gt;&gt;<i> <A HREF="http://www.gecode.org/cgi-bin/mailman/listinfo/users">users at gecode.org</A>
</I>&gt;&gt;&gt;&gt;&gt;<i> <A HREF="https://www.gecode.org/mailman/listinfo/gecode-users">https://www.gecode.org/mailman/listinfo/gecode-users</A>
</I>&gt;&gt;&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> _______________________________________________
</I>&gt;&gt;&gt;<i> Gecode users mailing list
</I>&gt;&gt;&gt;<i> <A HREF="http://www.gecode.org/cgi-bin/mailman/listinfo/users">users at gecode.org</A>
</I>&gt;&gt;&gt;<i> <A HREF="https://www.gecode.org/mailman/listinfo/gecode-users">https://www.gecode.org/mailman/listinfo/gecode-users</A>
</I>&gt;&gt;&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> _______________________________________________
</I>&gt;<i> Gecode users mailing list
</I>&gt;<i> <A HREF="http://www.gecode.org/cgi-bin/mailman/listinfo/users">users at gecode.org</A>
</I>&gt;<i> <A HREF="https://www.gecode.org/mailman/listinfo/gecode-users">https://www.gecode.org/mailman/listinfo/gecode-users</A>
</I>&gt;<i>
</I>


</PRE>


<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="004762.html">[gecode-users] Freeze with MSVC 2015 optimized build
</A></li>
	<LI>Next message: <A HREF="004764.html">[gecode-users] Disjunctive Minizinc constraint
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#4763">[ date ]</a>
              <a href="thread.html#4763">[ thread ]</a>
              <a href="subject.html#4763">[ subject ]</a>
              <a href="author.html#4763">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://www.gecode.org/cgi-bin/mailman/listinfo/users">More information about the users
mailing list</a><br>
</body></html>
